<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width; initial-scale=1.0">

  <title>
    API: simplenote-js
    
    
      &rarr; simplenote.js (file)
    
  </title>

  <link rel="stylesheet" type="text/css" href="css/960fluid.min.css">
  <link rel="stylesheet" type="text/css" href="css/jquery-ui-1.8.4.custom.css">
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <link rel="stylesheet" type="text/css" href="css/navigation.css">
  <link rel="stylesheet" type="text/css" href="css/content.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono">
  
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

</head>

<body>
  <div id="container" class="container_16">

    <!-- HEADER -->
    <header>
      <div id="hd" class="grid_10">
        <h1>
          <a href="http://github.com/carlo/simplenote-js" title="JS SimpleNote API wrapper">JS SimpleNote API wrapper</a> v1.0.1
        </h1>
      </div> <!--! end of #hd -->
    </header>

    <div id="filters" class="grid_6">
      <form action="#" method="get" id="show-toggles">
        <fieldset>
          <legend>Display Filters</legend>
          <span class="classopts">
            <input type="checkbox" name="show_private" id="show_private">
            <label for="show_private">Show private</label>
          </span>
          <span class="classopts">
            <input type="checkbox" name="show_protected" id="show_protected">
            <label for="show_protected">Show protected</label>
          </span>
          <span class="classopts">
            <input type="checkbox" name="show_deprecated" id="show_deprecated">
            <label for="show_deprecated">Show deprecated</label>
          </span>
        </fieldset>
      </form>

    </div> <!--! end of #hd -->


    <!-- SUB-HEADER w/ BREADCRUMBS -->

    <div id="sub-hd" class="grid_16">
      <div id="breadcrumbs">
        <form id="search-form" method="get" action="#">
          <label for="search">Search:</label>
          <input type="text" id="search" title="Find documentation">
        </form>

        <a href="./index.html" title="JS SimpleNote API wrapper">JS SimpleNote API wrapper</a>
          &rarr; module <a href="./module_simplenote-js.html" title="simplenote-js">simplenote-js</a>
          
          
            &rarr; file simplenote.js
          
      </div>
    </div> <!--! end of #sub-hd -->
    
    <div class="clear"></div>
    

    <!-- SIDEBAR NAVIGATION -->
    <nav>
      <div id="navigation" class="grid_4">
        <div>

            <div id="moduleList" class="module">
              <h4>Modules</h4>
              <ul>
                  <li  class="selected" >
                    <a href="module_simplenote-js.html">simplenote-js</a>
                  </li>
              </ul>
            </div>

            <div id="classList" class="module">
              <h4>Classes</h4>
              <ul>
                  <li >
                    <a href="SimpleNote.html">SimpleNote</a>
                  </li>
              </ul>
            </div>

            <div id="fileList" class="module">
              <h4>Files</h4>
              <ul>
                  <li  class="selected" >
                    <a href="simplenote.js.html">simplenote.js</a>
                  </li>
              </ul>
            </div>





        </div>
      </div>  <!-- end of #navigation -->
    </nav>


    <div id="content" class="grid_12">
      


        <!--! source code view -->
        <div id="srcout">
          <h2>
            file <strong>simplenote.js</strong>
          </h2>

          <div class="highlight"><pre><span class="cm">/*jslint adsafe: false, bitwise: true, browser: true, cap: false, css: false,</span>
<span class="cm">  debug: false, devel: true, eqeqeq: true, es5: false, evil: false,</span>
<span class="cm">  forin: false, fragment: false, immed: true, laxbreak: false, newcap: true,</span>
<span class="cm">  nomen: false, on: false, onevar: true, passfail: false, plusplus: true,</span>
<span class="cm">  regexp: false, rhino: true, safe: false, strict: false, sub: false,</span>
<span class="cm">  undef: true, white: false, widget: false, windows: false */</span>
<span class="cm">/*global jQuery: false, window: false */</span>
<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


<span class="cm">/*</span>
<span class="cm">* (c) 2010 Carlo Zottmann</span>
<span class="cm">* http://github.com/carlo/simplenote-js</span>
<span class="cm">*</span>
<span class="cm">* Permission is hereby granted, free of charge, to any person</span>
<span class="cm">* obtaining a copy of this software and associated documentation</span>
<span class="cm">* files (the &quot;Software&quot;), to deal in the Software without</span>
<span class="cm">* restriction, including without limitation the rights to use,</span>
<span class="cm">* copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="cm">* copies of the Software, and to permit persons to whom the</span>
<span class="cm">* Software is furnished to do so, subject to the following</span>
<span class="cm">* conditions:</span>
<span class="cm">*</span>
<span class="cm">* The above copyright notice and this permission notice shall be</span>
<span class="cm">* included in all copies or substantial portions of the Software.</span>
<span class="cm">*</span>
<span class="cm">* THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<span class="cm">* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES</span>
<span class="cm">* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="cm">* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT</span>
<span class="cm">* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,</span>
<span class="cm">* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<span class="cm">* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</span>
<span class="cm">* OTHER DEALINGS IN THE SOFTWARE.</span>
<span class="cm">*/</span>


<span class="cm">/**</span>
<span class="cm">* SimpleNote API wrapper module.</span>
<span class="cm">*</span>
<span class="cm">* @module     simplenote-js</span>
<span class="cm">*/</span>


<span class="cm">/**</span>
<span class="cm">* SimpleNote API wrapper class.</span>
<span class="cm">*</span>
<span class="cm">* Please note that the SimpleNote API expects everything to be UTF-8, and so</span>
<span class="cm">* does simplenote-js.</span>
<span class="cm">*</span>
<span class="cm">* @class      SimpleNote</span>
<span class="cm">* @requires   jquery</span>
<span class="cm">* @constructor</span>
<span class="cm">*/</span>

<span class="kd">function</span> <span class="nx">SimpleNote</span><span class="p">()</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">$</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">,</span>
  

  <span class="cm">/**</span>
<span class="cm">  * The simplenote-js version number.</span>
<span class="cm">  *</span>
<span class="cm">  * @property   _version</span>
<span class="cm">  * @type       String</span>
<span class="cm">  * @final</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="nx">_version</span> <span class="o">=</span> <span class="s2">&quot;1.0.1&quot;</span><span class="p">,</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * After a successful login, this variable holds the account email address</span>
<span class="cm">  * required for all subsequent API requests.</span>
<span class="cm">  *</span>
<span class="cm">  * @property   _email</span>
<span class="cm">  * @type       String</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="nx">_email</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  

  <span class="cm">/**</span>
<span class="cm">  * After a successful login, this variable holds the auth token required for</span>
<span class="cm">  * all subsequent API requests.</span>
<span class="cm">  *</span>
<span class="cm">  * @property   _token</span>
<span class="cm">  * @type       String</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="nx">_token</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Contains the base URL of the API.</span>
<span class="cm">  *</span>
<span class="cm">  * @property   _baseURL</span>
<span class="cm">  * @type       String</span>
<span class="cm">  * @final</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="nx">_baseURL</span> <span class="o">=</span> <span class="s2">&quot;https://simple-note.appspot.com/api&quot;</span><span class="p">,</span>

  
  <span class="cm">/**</span>
<span class="cm">  * Contains the OpenData table used for all YQL calls.</span>
<span class="cm">  *</span>
<span class="cm">  * @property   _yqlTableURL</span>
<span class="cm">  * @type       String</span>
<span class="cm">  * @default    http://github.com/carlo/simplenote-js/raw/master/src/yql_simplenote.xml</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="nx">_yqlTableURL</span> <span class="o">=</span> <span class="s2">&quot;http://github.com/carlo/simplenote-js/raw/master/src/yql_simplenote.xml&quot;</span><span class="p">,</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Contains the table name used in YQL query.</span>
<span class="cm">  *</span>
<span class="cm">  * @property   _yqlTableName</span>
<span class="cm">  * @type       String</span>
<span class="cm">  * @final</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="nx">_yqlTableName</span> <span class="o">=</span> <span class="s2">&quot;snjs&quot;</span> <span class="o">+</span> <span class="p">(</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="p">).</span><span class="nx">getTime</span><span class="p">(),</span>
  

  <span class="cm">/**</span>
<span class="cm">  * Enables console output of debugging messages.</span>
<span class="cm">  *</span>
<span class="cm">  * @property   _debugEnabled</span>
<span class="cm">  * @type       Boolean</span>
<span class="cm">  * @default    false</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="nx">_debugEnabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  
  
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">$</span><span class="p">.</span><span class="nx">base64</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="s2">&quot;FATAL ERROR: jQuery.base64 is not available!&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="kd">function</span> <span class="nx">log</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">history</span> <span class="o">=</span> <span class="nx">log</span><span class="p">.</span><span class="nx">history</span> <span class="o">||</span> <span class="p">[];</span>   <span class="c1">// store logs to an array for reference</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">arguments</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nb">window</span><span class="p">.</span><span class="nx">console</span> <span class="o">&amp;&amp;</span> <span class="nx">_debugEnabled</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">arguments</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  
  <span class="cm">/**</span>
<span class="cm">  * Deletes both `_email` and `_token` variables.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _clearCredentials</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_clearCredentials</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">_email</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="nx">_token</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Returns a boolean showing whether the user is currently logged in or not.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _isLoggedIn</span>
<span class="cm">  * @return     {Boolean}</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_isLoggedIn</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span> <span class="o">!!</span><span class="nx">_email</span> <span class="o">&amp;&amp;</span> <span class="o">!!</span><span class="nx">_token</span> <span class="p">);</span>
  <span class="p">}</span>


  <span class="cm">/**</span>
<span class="cm">  * Throws an exception if either the internal email or token aren&#39;t set</span>
<span class="cm">  * (which means the user&#39;s not logged in).</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _throwUnlessLoggedIn</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_throwUnlessLoggedIn</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">_isLoggedIn</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;AuthError&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>


  <span class="cm">/**</span>
<span class="cm">  * Accepts a YQL query and returns the related YQL URL.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _getYQLURL</span>
<span class="cm">  * @param      query {String} YQL query</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_getYQLURL</span><span class="p">(</span> <span class="nx">query</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
      <span class="s2">&quot;https://query.yahooapis.com/v1/public/yql?q=&quot;</span><span class="p">,</span>
      <span class="nb">encodeURIComponent</span><span class="p">(</span> <span class="nx">query</span> <span class="p">),</span>
      <span class="s2">&quot;&amp;diagnostics=true&quot;</span><span class="p">,</span>
      <span class="s2">&quot;&amp;format=json&quot;</span><span class="p">,</span>
      <span class="s2">&quot;&amp;env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&quot;</span>
    <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
  <span class="p">}</span>


  <span class="cm">/**</span>
<span class="cm">  * Returns an error code for a passed HTTP status.</span>
<span class="cm">  * </span>
<span class="cm">  * @method     _getErrorCode</span>
<span class="cm">  * @param      status {String} The HTTP status code returned by YQL.</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>

  <span class="kd">function</span> <span class="nx">_getErrorCode</span><span class="p">(</span> <span class="nx">status</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">codes</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s2">&quot;400&quot;</span><span class="o">:</span> <span class="s2">&quot;bad_request&quot;</span><span class="p">,</span>
      <span class="s2">&quot;401&quot;</span><span class="o">:</span> <span class="s2">&quot;unauthorized&quot;</span><span class="p">,</span>
      <span class="s2">&quot;403&quot;</span><span class="o">:</span> <span class="s2">&quot;forbidden&quot;</span><span class="p">,</span>
      <span class="s2">&quot;404&quot;</span><span class="o">:</span> <span class="s2">&quot;not_found&quot;</span><span class="p">,</span>
      <span class="s2">&quot;500&quot;</span><span class="o">:</span> <span class="s2">&quot;server_error&quot;</span>
    <span class="p">};</span>

    <span class="nx">status</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span> <span class="nx">status</span> <span class="p">);</span>
    
    <span class="k">return</span> <span class="nx">codes</span><span class="p">[</span> <span class="nx">status</span> <span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;unknown_error&quot;</span><span class="p">;</span>
  <span class="p">}</span>  <span class="c1">// _getErrorCode</span>
 

  <span class="cm">/**</span>
<span class="cm">  * Proxy method abstracting most YQL calls.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _queryYQL</span>
<span class="cm">  * @param      caller {String} Name of the calling method.  Used for log</span>
<span class="cm">  *             output.</span>
<span class="cm">  * @param      query {String} The YQL query.</span>
<span class="cm">  * @param      cbSuccess {Function} The on-success callback.</span>
<span class="cm">  * @param      cbError {Function} The on-error callback.</span>
<span class="cm">  * @param      context {Object} The context of the callbacks mentioned above.</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_queryYQL</span><span class="p">(</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">cbSuccess</span><span class="p">,</span> <span class="nx">cbError</span><span class="p">,</span> <span class="nx">context</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">url</span><span class="o">:</span> <span class="nx">_getYQLURL</span><span class="p">(</span> <span class="nx">query</span> <span class="p">),</span>
      <span class="nx">context</span><span class="o">:</span> <span class="nx">context</span><span class="p">,</span>
      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">req</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">yqlStatus</span><span class="p">,</span>
          <span class="nx">yqlStatusCode</span><span class="p">,</span>
          <span class="nx">res</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">data</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">query</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">results</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">log</span><span class="p">(</span> <span class="nx">caller</span> <span class="o">+</span> <span class="s2">&quot; error #1&quot;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
          <span class="nx">cbError</span><span class="p">(</span> <span class="s2">&quot;yql_error&quot;</span> <span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="nx">yqlStatus</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="p">(</span> <span class="nx">yqlStatus</span> <span class="o">!==</span> <span class="s2">&quot;200&quot;</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">yqlStatusCode</span> <span class="o">=</span> <span class="nx">_getErrorCode</span><span class="p">(</span> <span class="nx">yqlStatus</span> <span class="p">);</span>

          <span class="k">if</span> <span class="p">(</span> <span class="nx">yqlStatus</span> <span class="o">===</span> <span class="s2">&quot;401&quot;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">_clearCredentials</span><span class="p">();</span>
          <span class="p">}</span>

          <span class="nx">log</span><span class="p">(</span> <span class="nx">caller</span> <span class="o">+</span> <span class="s2">&quot; error #2&quot;</span><span class="p">,</span> <span class="nx">yqlStatusCode</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
          <span class="nx">cbError</span><span class="p">(</span> <span class="nx">yqlStatusCode</span> <span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">log</span><span class="p">(</span> <span class="nx">caller</span> <span class="o">+</span> <span class="s2">&quot; success&quot;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
        
        <span class="nx">res</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">res</span><span class="p">.</span><span class="nx">response</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">response</span> <span class="o">=</span> <span class="sr">/^[\[\{]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="nx">res</span><span class="p">.</span><span class="nx">response</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span> <span class="nx">res</span><span class="p">.</span><span class="nx">response</span> <span class="p">)</span> <span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">response</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">cbSuccess</span><span class="p">(</span> <span class="nx">res</span> <span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">(</span> <span class="nx">caller</span> <span class="o">+</span> <span class="s2">&quot; error #3&quot;</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span> <span class="p">);</span>
        <span class="nx">cbError</span><span class="p">(</span> <span class="s2">&quot;unknown&quot;</span> <span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;jsonp&quot;</span><span class="p">,</span>
      <span class="nx">scriptCharset</span><span class="o">:</span> <span class="s2">&quot;utf-8&quot;</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Authenticates the client.  The request is made asynchronously via YQL.</span>
<span class="cm">  * Throws an exception if one of the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * The method expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `email`: SimpleNote account email address</span>
<span class="cm">  * * `password`: SimpleNote account password</span>
<span class="cm">  * * `success`: callback function to be called on successful authentication</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * Both `success` and `error` are strictly speaking optional; omitting them</span>
<span class="cm">  * might be pointless, tho.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _authenticate</span>
<span class="cm">  * @param      config {Object} SimpleNote account email address, password,</span>
<span class="cm">  *             callbacks</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_authenticate</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">obj</span> <span class="o">||</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">email</span> <span class="o">||</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">password</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;ArgumentError: email and password required&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">var</span> <span class="nx">query</span><span class="p">,</span>
      <span class="nx">config</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">alert</span><span class="p">(</span> <span class="s2">&quot;SimpleNote auth success&quot;</span> <span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">errorCode</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">alert</span><span class="p">(</span> <span class="s2">&quot;SimpleNote auth error: &quot;</span> <span class="o">+</span> <span class="nx">errorCode</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span> <span class="nx">obj</span> <span class="p">);</span>
      
    <span class="nx">query</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;USE &#39;&quot;</span><span class="p">,</span> <span class="nx">_yqlTableURL</span><span class="p">,</span> <span class="s2">&quot;&#39; AS &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot;; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;SELECT * FROM &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;WHERE path=&#39;/login&#39; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;AND method=&#39;post&#39; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;AND data=&#39;&quot;</span><span class="p">,</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">base64</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">({</span> <span class="nx">email</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">password</span> <span class="p">})</span>
        <span class="p">),</span>
      <span class="s2">&quot;&#39;&quot;</span>
    <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
    
    <span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;_authenticate&quot;</span><span class="p">,</span> <span class="nx">query</span> <span class="p">);</span>
    
    <span class="kd">function</span> <span class="nx">__cbSuccess</span><span class="p">(</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">_email</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
      <span class="nx">_token</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">result</span><span class="p">.</span><span class="nx">response</span> <span class="p">);</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">success</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">__cbError</span><span class="p">(</span> <span class="nx">code</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">_clearCredentials</span><span class="p">();</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="nx">code</span> <span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">_queryYQL</span><span class="p">(</span> <span class="s2">&quot;_authenticate&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">__cbSuccess</span><span class="p">,</span> <span class="nx">__cbError</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">}</span>  <span class="c1">// _authenticate</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Checks if the passed argument is an object and has `error` and `success`</span>
<span class="cm">  * keys which are functions.  Throws an `ArgumentError` exception on failure.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _validateRetrievalConfig</span>
<span class="cm">  * @param      obj {Object} The object to validate.</span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_validateRetrievalConfig</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">$</span><span class="p">.</span><span class="nx">isPlainObject</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;ArgumentError: argument must be object&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">$</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">success</span> <span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">$</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">error</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;ArgumentError: callbacks missing&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  
  <span class="cm">/**</span>
<span class="cm">  * Returns an index of all notes.  This method will return a JSON object with</span>
<span class="cm">  * three main properties for each note: `key`, `modify`, and `deleted`.  Some</span>
<span class="cm">  * notes may be marked `deleted`; these notes will be removed permanently</span>
<span class="cm">  * the next time the client synchronizes with the server.</span>
<span class="cm">  *</span>
<span class="cm">  * Throws an exception if one of the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * The method expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the array containing the notes index</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * The index will be returned as an array containing hashes.  The hashes</span>
<span class="cm">  * contain the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `deleted`: true | false</span>
<span class="cm">  * * `key`: the note ID</span>
<span class="cm">  * * `modify`: a string containing the last-modified date</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _retrieveIndex</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_retrieveIndex</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_throwUnlessLoggedIn</span><span class="p">();</span>
    <span class="nx">_validateRetrievalConfig</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>

    <span class="kd">var</span> <span class="nx">query</span><span class="p">,</span>
      <span class="nx">config</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">json</span> <span class="p">)</span> <span class="p">{},</span>
        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">errorString</span> <span class="p">)</span> <span class="p">{}</span>
      <span class="p">},</span> <span class="nx">obj</span> <span class="p">);</span>
      
    <span class="nx">query</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;USE &#39;&quot;</span><span class="p">,</span> <span class="nx">_yqlTableURL</span><span class="p">,</span> <span class="s2">&quot;&#39; AS &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot;; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;SELECT * FROM &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;WHERE path=&#39;/index&#39; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;AND data=&#39;&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">({</span> <span class="nx">email</span><span class="o">:</span> <span class="nx">_email</span><span class="p">,</span> <span class="nx">auth</span><span class="o">:</span> <span class="nx">_token</span> <span class="p">}),</span> <span class="s2">&quot;&#39;&quot;</span>
    <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
    
    <span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;_retrieveIndex&quot;</span><span class="p">,</span> <span class="nx">query</span> <span class="p">);</span>
    
    <span class="kd">function</span> <span class="nx">__cbSuccess</span><span class="p">(</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span> <span class="nx">result</span><span class="p">.</span><span class="nx">response</span> <span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">_queryYQL</span><span class="p">(</span> <span class="s2">&quot;_retrieveIndex&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">__cbSuccess</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">}</span>  <span class="c1">// _retrieveIndex</span>


  <span class="cm">/**</span>
<span class="cm">  * Returns notes containing a particular term.  Throws an exception if one of</span>
<span class="cm">  * the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * This method will return a JSON object with two keys, `notes` (containing</span>
<span class="cm">  * an array with found notes) and `totalRecords` (showing the total number of</span>
<span class="cm">  * search results).</span>
<span class="cm">  *</span>
<span class="cm">  * Each note is represented as an object containing two keys, `key` (the note</span>
<span class="cm">  * ID) and `body` (the note string).</span>
<span class="cm">  *</span>
<span class="cm">  * The method expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `query`: search string</span>
<span class="cm">  * * `maxResults` (optional): max number of results (default: 10)</span>
<span class="cm">  * * `offset` (optional): index offset</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the array containing the notes index</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _searchNotes</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>

  <span class="kd">function</span> <span class="nx">_searchNotes</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_throwUnlessLoggedIn</span><span class="p">();</span>
    <span class="nx">_validateRetrievalConfig</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">query</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;ArgumentError: query is missing&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">query</span><span class="p">,</span>
      <span class="nx">config</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">json</span> <span class="p">)</span> <span class="p">{},</span>
        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">errorString</span> <span class="p">)</span> <span class="p">{}</span>
      <span class="p">},</span> <span class="nx">obj</span> <span class="p">);</span>

    <span class="nx">config</span><span class="p">.</span><span class="nx">query</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">config</span><span class="p">.</span><span class="nx">query</span> <span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">config</span><span class="p">.</span><span class="nx">maxResults</span> <span class="o">!==</span> <span class="s2">&quot;number&quot;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">maxResults</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">config</span><span class="p">.</span><span class="nx">offset</span> <span class="o">!==</span> <span class="s2">&quot;number&quot;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">query</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;USE &#39;&quot;</span><span class="p">,</span> <span class="nx">_yqlTableURL</span><span class="p">,</span> <span class="s2">&quot;&#39; AS &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot;; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;SELECT * FROM &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;WHERE path=&#39;/search&#39; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;AND data=&#39;&quot;</span><span class="p">,</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">({</span>
        <span class="nx">email</span><span class="o">:</span> <span class="nx">_email</span><span class="p">,</span>
        <span class="nx">auth</span><span class="o">:</span> <span class="nx">_token</span><span class="p">,</span>
        <span class="nx">query</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span>
        <span class="nx">results</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">maxResults</span><span class="p">,</span>
        <span class="nx">offset</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">offset</span>
      <span class="p">}),</span> <span class="s2">&quot;&#39;&quot;</span>
    <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
    
    <span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;_searchNotes&quot;</span><span class="p">,</span> <span class="nx">query</span> <span class="p">);</span>
    
    <span class="kd">function</span> <span class="nx">__cbSuccess</span><span class="p">(</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span>
        <span class="nx">hash</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">totalRecords</span><span class="o">:</span> <span class="nb">Number</span><span class="p">(</span> <span class="nx">res</span><span class="p">.</span><span class="nx">totalRecords</span> <span class="p">),</span>
          <span class="nx">notes</span><span class="o">:</span> <span class="p">[]</span>
        <span class="p">},</span>
        <span class="nx">numResults</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">totalRecords</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">res</span><span class="p">.</span><span class="nx">Results</span><span class="p">.</span><span class="nx">length</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">i</span><span class="p">;</span>
      
      <span class="k">for</span> <span class="p">(</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">numResults</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">hash</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">key</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">Results</span><span class="p">[</span> <span class="nx">i</span> <span class="p">].</span><span class="nx">key</span><span class="p">,</span>
          <span class="nx">body</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">Results</span><span class="p">[</span> <span class="nx">i</span> <span class="p">].</span><span class="nx">content</span>
        <span class="p">});</span>
      <span class="p">}</span>

      <span class="nx">config</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span> <span class="nx">hash</span> <span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">_queryYQL</span><span class="p">(</span> <span class="s2">&quot;_searchNotes&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">__cbSuccess</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">}</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Retrieves and returns a single note as a hash in the following form:</span>
<span class="cm">  *</span>
<span class="cm">  *     {</span>
<span class="cm">  *       body: &quot;my example note&quot;,</span>
<span class="cm">  *       key: &quot;agtzaW1wbG0LCxIETm90ZRjoBAw&quot;,</span>
<span class="cm">  *       modifydate: &quot;2008-12-18 04:04:20.554442&quot;,</span>
<span class="cm">  *       createdate: &quot;2008-12-18 04:04:20.554442&quot;,</span>
<span class="cm">  *       deleted: false</span>
<span class="cm">  *     }  </span>
<span class="cm">  *</span>
<span class="cm">  * Throws an exception if one of the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * Expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `key`: the note ID</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the note hash</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _retrieveNote</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_retrieveNote</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_throwUnlessLoggedIn</span><span class="p">();</span>
    <span class="nx">_validateRetrievalConfig</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">key</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;ArgumentError: key is missing&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">query</span><span class="p">,</span>
      <span class="nx">config</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">json</span> <span class="p">)</span> <span class="p">{},</span>
        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">errorString</span> <span class="p">)</span> <span class="p">{}</span>
      <span class="p">},</span> <span class="nx">obj</span> <span class="p">);</span>
      
    <span class="nx">query</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;USE &#39;&quot;</span><span class="p">,</span> <span class="nx">_yqlTableURL</span><span class="p">,</span> <span class="s2">&quot;&#39; AS &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot;; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;SELECT * FROM &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;WHERE path=&#39;/note&#39; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;AND data=&#39;&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">({</span> <span class="nx">email</span><span class="o">:</span> <span class="nx">_email</span><span class="p">,</span> <span class="nx">auth</span><span class="o">:</span> <span class="nx">_token</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">key</span> <span class="p">}),</span> <span class="s2">&quot;&#39;&quot;</span>
    <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
    
    <span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;_retrieveNote&quot;</span><span class="p">,</span> <span class="nx">query</span> <span class="p">);</span>
    
    <span class="kd">function</span> <span class="nx">__cbSuccess</span><span class="p">(</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">success</span><span class="p">({</span>
        <span class="nx">body</span><span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">result</span><span class="p">.</span><span class="nx">response</span> <span class="p">),</span>
        <span class="nx">key</span><span class="o">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span> <span class="s2">&quot;note-key&quot;</span> <span class="p">],</span>
        <span class="nx">modifydate</span><span class="o">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span> <span class="s2">&quot;note-modifydate&quot;</span> <span class="p">],</span>
        <span class="nx">createdate</span><span class="o">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span> <span class="s2">&quot;note-createdate&quot;</span> <span class="p">],</span>
        <span class="nx">deleted</span><span class="o">:</span> <span class="p">(</span> <span class="nx">result</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span> <span class="s2">&quot;note-deleted&quot;</span> <span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="s2">&quot;true&quot;</span> <span class="p">)</span>
      <span class="p">});</span>
    <span class="p">}</span>
    
    <span class="nx">_queryYQL</span><span class="p">(</span> <span class="s2">&quot;_retrieveNote&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">__cbSuccess</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">}</span>  <span class="c1">// _retrieveNote</span>


  <span class="cm">/**</span>
<span class="cm">  * Creates a new note.  Returns the new note ID.  Throws an exception if one</span>
<span class="cm">  * of the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * Expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `body`: a string containing the note body</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the note ID string</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _createNote</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_createNote</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_throwUnlessLoggedIn</span><span class="p">();</span>
    <span class="nx">_validateRetrievalConfig</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">body</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;ArgumentError: body is missing&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">query</span><span class="p">,</span>
      <span class="nx">config</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">json</span> <span class="p">)</span> <span class="p">{},</span>
        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">errorString</span> <span class="p">)</span> <span class="p">{}</span>
      <span class="p">},</span> <span class="nx">obj</span> <span class="p">);</span>
    
    <span class="nx">config</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">config</span><span class="p">.</span><span class="nx">body</span> <span class="p">);</span>
      
    <span class="nx">query</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;USE &#39;&quot;</span><span class="p">,</span> <span class="nx">_yqlTableURL</span><span class="p">,</span> <span class="s2">&quot;&#39; AS &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot;; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;SELECT * FROM &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;WHERE path=&#39;/note?&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">({</span> <span class="nx">email</span><span class="o">:</span> <span class="nx">_email</span><span class="p">,</span> <span class="nx">auth</span><span class="o">:</span> <span class="nx">_token</span> <span class="p">}),</span> <span class="s2">&quot;&#39; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;AND data=&#39;&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">base64</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span> <span class="nx">config</span><span class="p">.</span><span class="nx">body</span> <span class="p">),</span> <span class="s2">&quot;&#39; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;AND method=&#39;post&#39;&quot;</span>
    <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
    
    <span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;_createNote&quot;</span><span class="p">,</span> <span class="nx">query</span> <span class="p">);</span>
    
    <span class="kd">function</span> <span class="nx">__cbSuccess</span><span class="p">(</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">result</span><span class="p">.</span><span class="nx">response</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">_queryYQL</span><span class="p">(</span> <span class="s2">&quot;_createNote&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">__cbSuccess</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">}</span>  <span class="c1">// _createNote</span>


  <span class="cm">/**</span>
<span class="cm">  * Updates an existing note.  Returns the note ID on success.  Throws an</span>
<span class="cm">  * exception if one of the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * Expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `key`: the ID of the note to update</span>
<span class="cm">  * * `body`: a string containing the note body</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the note ID string</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _updateNote</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_updateNote</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_throwUnlessLoggedIn</span><span class="p">();</span>
    <span class="nx">_validateRetrievalConfig</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">body</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;ArgumentError: body is missing&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">key</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;ArgumentError: key is missing&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">query</span><span class="p">,</span>
      <span class="nx">config</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">json</span> <span class="p">)</span> <span class="p">{},</span>
        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">errorString</span> <span class="p">)</span> <span class="p">{}</span>
      <span class="p">},</span> <span class="nx">obj</span> <span class="p">);</span>
      
    <span class="nx">config</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">config</span><span class="p">.</span><span class="nx">body</span> <span class="p">);</span>

    <span class="nx">query</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;USE &#39;&quot;</span><span class="p">,</span> <span class="nx">_yqlTableURL</span><span class="p">,</span> <span class="s2">&quot;&#39; AS &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot;; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;SELECT * FROM &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;WHERE path=&#39;/note?&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">({</span> <span class="nx">email</span><span class="o">:</span> <span class="nx">_email</span><span class="p">,</span> <span class="nx">auth</span><span class="o">:</span> <span class="nx">_token</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">key</span> <span class="p">}),</span> <span class="s2">&quot;&#39; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;AND data=&#39;&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">base64</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span> <span class="nx">config</span><span class="p">.</span><span class="nx">body</span> <span class="p">),</span> <span class="s2">&quot;&#39; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;AND method=&#39;post&#39;&quot;</span>
    <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
    
    <span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;_updateNote&quot;</span><span class="p">,</span> <span class="nx">query</span> <span class="p">);</span>
    
    <span class="kd">function</span> <span class="nx">__cbSuccess</span><span class="p">(</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">result</span><span class="p">.</span><span class="nx">response</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">_queryYQL</span><span class="p">(</span> <span class="s2">&quot;_updateNote&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">__cbSuccess</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">}</span>  <span class="c1">// _updateNote</span>

  
  <span class="cm">/**</span>
<span class="cm">  * Deletes an existing note.  Throws an exception if one of the arguments is</span>
<span class="cm">  * missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * Expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `key`: the ID of the note to update</span>
<span class="cm">  * * `permanently` (optional): set to `true` if you want to not only mark the</span>
<span class="cm">  *    note as deleted on the server but to delete it right away (see SN API</span>
<span class="cm">  *    docs)</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the note ID string</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     _deleteNote</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  * @private</span>
<span class="cm">  */</span>
  
  <span class="kd">function</span> <span class="nx">_deleteNote</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_throwUnlessLoggedIn</span><span class="p">();</span>
    <span class="nx">_validateRetrievalConfig</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">key</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;ArgumentError: key is missing&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">query</span><span class="p">,</span>
      <span class="nx">config</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">json</span> <span class="p">)</span> <span class="p">{},</span>
        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">errorString</span> <span class="p">)</span> <span class="p">{}</span>
      <span class="p">},</span> <span class="nx">obj</span> <span class="p">);</span>
      
    <span class="nx">query</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;USE &#39;&quot;</span><span class="p">,</span> <span class="nx">_yqlTableURL</span><span class="p">,</span> <span class="s2">&quot;&#39; AS &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot;; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;SELECT * FROM &quot;</span><span class="p">,</span> <span class="nx">_yqlTableName</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;WHERE path=&#39;/delete&#39; &quot;</span><span class="p">,</span>
      <span class="s2">&quot;AND data=&#39;&quot;</span><span class="p">,</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">({</span>
        <span class="nx">email</span><span class="o">:</span> <span class="nx">_email</span><span class="p">,</span>
        <span class="nx">auth</span><span class="o">:</span> <span class="nx">_token</span><span class="p">,</span>
        <span class="nx">key</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span>
        <span class="nx">dead</span><span class="o">:</span> <span class="p">(</span> <span class="nx">config</span><span class="p">.</span><span class="nx">permanently</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;1&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span>
      <span class="p">}),</span>
      <span class="s2">&quot;&#39; &quot;</span>
    <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
    
    <span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;_deleteNote&quot;</span><span class="p">,</span> <span class="nx">query</span> <span class="p">);</span>
    
    <span class="kd">function</span> <span class="nx">__cbSuccess</span><span class="p">(</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">result</span><span class="p">.</span><span class="nx">response</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">_queryYQL</span><span class="p">(</span> <span class="s2">&quot;_deleteNote&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">__cbSuccess</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">}</span>  <span class="c1">// _deleteNote</span>




  <span class="c1">// ============ PUBLIC METHODS &amp; PROPERTIES ================================</span>



  
  <span class="cm">/**</span>
<span class="cm">  * Authenticates the client.  The request is made asynchronously via YQL.</span>
<span class="cm">  * Throws an exception if one of the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * The method expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `email`: SimpleNote account email address</span>
<span class="cm">  * * `password`: SimpleNote account password</span>
<span class="cm">  * * `success`: callback function to be called on successful authentication</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * Both `success` and `error` are strictly speaking optional; omitting them</span>
<span class="cm">  * might be pointless, tho.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     auth</span>
<span class="cm">  * @param      config {Object} SimpleNote account email address, password,</span>
<span class="cm">  *             callbacks</span>
<span class="cm">  */</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">auth</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">config</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_authenticate</span><span class="p">(</span> <span class="nx">config</span> <span class="p">);</span>
  <span class="p">};</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Returns an index of all notes.  This method will return a JSON object with</span>
<span class="cm">  * three main properties for each note: `key`, `modify`, and `deleted`.  Some</span>
<span class="cm">  * notes may be marked `deleted`; these notes will be removed permanently</span>
<span class="cm">  * the next time the client synchronizes with the server.</span>
<span class="cm">  *</span>
<span class="cm">  * The method expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the array containing the notes index</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * Throws an exception if one of the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     retrieveIndex</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  */</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">retrieveIndex</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_retrieveIndex</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>
  <span class="p">};</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Returns notes containing a particular term.  Throws an exception if one of</span>
<span class="cm">  * the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * This method will return a JSON object with two keys, `notes` (containing</span>
<span class="cm">  * an array with found notes) and `totalRecords` (showing the total number of</span>
<span class="cm">  * search results).</span>
<span class="cm">  *</span>
<span class="cm">  * Each note is represented as an object containing two keys, `key` (the note</span>
<span class="cm">  * ID) and `body` (the note string).</span>
<span class="cm">  *</span>
<span class="cm">  * The method expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `query`: search string</span>
<span class="cm">  * * `maxResults` (optional): max number of results (default: 10)</span>
<span class="cm">  * * `offset` (optional): index offset</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the array containing the notes index</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     searchNotes</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  */</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">searchNotes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_searchNotes</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>
  <span class="p">};</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Retrieves and returns a single note as a hash in the following form:</span>
<span class="cm">  *</span>
<span class="cm">  *     {</span>
<span class="cm">  *       body: &quot;my example note&quot;,</span>
<span class="cm">  *       key: &quot;agtzaW1wbG0LCxIETm90ZRjoBAw&quot;,</span>
<span class="cm">  *       modifydate: &quot;2008-12-18 04:04:20.554442&quot;,</span>
<span class="cm">  *       createdate: &quot;2008-12-18 04:04:20.554442&quot;,</span>
<span class="cm">  *       deleted: false</span>
<span class="cm">  *     }  </span>
<span class="cm">  *</span>
<span class="cm">  * Expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `key`: the note ID</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the note hash</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * Throws an exception if one of the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     retrieveNote</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  */</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">retrieveNote</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_retrieveNote</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>
  <span class="p">};</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Creates a new note.  Returns the new note ID.  Throws an exception if one</span>
<span class="cm">  * of the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * Expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `body`: a string containing the note body</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the note ID string</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     createNote</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  */</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">createNote</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_createNote</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>
  <span class="p">};</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Updates an existing note.  Returns the note ID on success.  Throws an</span>
<span class="cm">  * exception if one of the arguments is missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * Expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `key`: the ID of the note to update</span>
<span class="cm">  * * `body`: a string containing the note body</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the note ID string</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     updateNote</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  */</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">updateNote</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_updateNote</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>
  <span class="p">};</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Deletes an existing note.  Throws an exception if one of the arguments is</span>
<span class="cm">  * missing or empty.</span>
<span class="cm">  *</span>
<span class="cm">  * Expects a configuration object with the following keys:</span>
<span class="cm">  *</span>
<span class="cm">  * * `key`: the ID of the note to update</span>
<span class="cm">  * * `permanently` (optional): set to `true` if you want to not only mark the</span>
<span class="cm">  *    note as deleted on the server but to delete it right away (see SN API</span>
<span class="cm">  *    docs)</span>
<span class="cm">  * * `success`: callback function to be called on success; the callback will</span>
<span class="cm">  *    be passed the note ID string</span>
<span class="cm">  * * `error`: callback function to be called on failure, is passed a clear</span>
<span class="cm">  *    text error string.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     deleteNote</span>
<span class="cm">  * @param      config {Object} </span>
<span class="cm">  */</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">deleteNote</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_deleteNote</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">);</span>
  <span class="p">};</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Returns a boolean showing whether the user is currently logged in or not.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     isLoggedIn</span>
<span class="cm">  * @return     {Boolean}</span>
<span class="cm">  */</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">isLoggedIn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_isLoggedIn</span><span class="p">();</span>
  <span class="p">};</span>
    

  <span class="cm">/**</span>
<span class="cm">  * Returns auth details, i.e. an object containing the current email address</span>
<span class="cm">  * and auth token returned by the API after a successful login.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     getAuthDetails</span>
<span class="cm">  * @return     {Object} Auth info.</span>
<span class="cm">  */</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">getAuthDetails</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">token</span><span class="o">:</span> <span class="nx">_token</span><span class="p">,</span>
      <span class="nx">email</span><span class="o">:</span> <span class="nx">_email</span>
    <span class="p">};</span>
  <span class="p">};</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Sets the Open Data table used in all YQL requests.  Usually, you&#39;ll want</span>
<span class="cm">  * to put the Open Data table XML file (see `yql_simplenote.xml`) on a server</span>
<span class="cm">  * controlled by you so you have full control over it.  If you do that, you</span>
<span class="cm">  * can tell `SimpleNote` to use it by setting the new URL with this method.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     setOpenDataTable</span>
<span class="cm">  */</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">setOpenDataTable</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">url</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_yqlTableURL</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
  <span class="p">};</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Returns the Open Data table used in all YQL requests.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     getOpenDataTable</span>
<span class="cm">  * @return     {String} Open Data Table URL.</span>
<span class="cm">  */</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">getOpenDataTable</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_yqlTableURL</span><span class="p">;</span>
  <span class="p">};</span>
  
  
  <span class="cm">/**</span>
<span class="cm">  * Enables console output of debugging messages.</span>
<span class="cm">  *</span>
<span class="cm">  * @method     enableDebug</span>
<span class="cm">  * @param      bool {Boolean} Enable/disable debugging.</span>
<span class="cm">  */</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">enableDebug</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">bool</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">_debugEnabled</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">bool</span><span class="p">;</span>
  <span class="p">};</span>


  <span class="cm">/**</span>
<span class="cm">  * Returns the simplenote-js version number.</span>
<span class="cm">  *</span>
<span class="cm">  * @property   VERSION</span>
<span class="cm">  * @type       String</span>
<span class="cm">  * @final</span>
<span class="cm">  */</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">VERSION</span> <span class="o">=</span> <span class="nx">_version</span><span class="p">;</span>
  

  <span class="cm">/*</span>
<span class="cm">  this.debug = {</span>
<span class="cm">    showToken: function() {</span>
<span class="cm">      return $.param({</span>
<span class="cm">        auth: _token,</span>
<span class="cm">        email: _email</span>
<span class="cm">      });</span>
<span class="cm">    }</span>
<span class="cm">  };</span>
<span class="cm">  */</span>
  
<span class="p">}</span>
</pre></div>

        </div>

    </div>


    <div class="clear"></div>

    
    <footer>
      <div id="footer" class="grid_16">
        <p>
          Copyright &copy; 2010 Carlo Zottmann, carlo@zottmann.org.. All rights reserved.
          &middot;
          Docs generated using <a href="http://developer.yahoo.com/yui/yuidoc/">YUIDoc</a> sporting the <a href="http://github.com/carlo/yuidoc-theme-dana">Dana theme</a>.
        </p>
      </div> <!--! end of #footer -->
    </footer>


    <div class="clear"></div>

  </div>

  <!-- Javascript at the bottom for fast page loading -->
  <script src="js/jquery-1.4.2.min.js" type="text/javascript"></script>
  <script src="js/jquery-ui-1.8.4.custom.min.js" type="text/javascript"></script>
  <script src="js/jquery.cookie.min.js" type="text/javascript"></script>
  <script src="js/main.js" type="text/javascript"></script>
  
</body>
</html>
